import{_ as p,o as n,c as a,j as e,a0 as c,a2 as g,a9 as m,t as d,e as h,n as b}from"./framework.CElktlHO.js";const f={props:{show:{type:Boolean,required:!0}},emits:["close","login-success"],data(){return{activeTab:"login",loginForm:{email:"",password:""},registerForm:{username:"",email:"",password:""},loginError:"",registerError:""}},watch:{show(t){t&&(this.loginForm={email:"",password:""},this.registerForm={username:"",email:"",password:""},this.loginError="",this.registerError="",this.activeTab="login")}},methods:{async handleLogin(){console.log("Attempting login with:",this.loginForm);const t=JSON.parse(localStorage.getItem("users")||"[]");console.log("Found users:",t);const s=t.find(l=>l.email===this.loginForm.email&&l.password===this.loginForm.password);console.log("Found user:",s),s?(console.log("Login successful"),localStorage.setItem("currentUser",JSON.stringify(s)),this.$emit("login-success",s),this.$emit("close"),this.loginForm={email:"",password:""},this.loginError=""):(console.log("Login failed"),this.loginError="邮箱或密码错误")},async handleRegister(){if(console.log("Attempting registration with:",this.registerForm),!this.registerForm.username||!this.registerForm.email||!this.registerForm.password){this.registerError="所有字段都必须填写",console.log("Registration failed: Missing fields");return}if(this.registerForm.password.length<6){this.registerError="密码长度至少6位",console.log("Registration failed: Password too short");return}if(this.checkEmailExists(this.registerForm.email)){this.registerError="邮箱已被注册",console.log("Registration failed: Email exists");return}const t={...this.registerForm,id:Date.now(),createdAt:new Date().toISOString()};console.log("Creating new user:",t);try{const s=JSON.parse(localStorage.getItem("users")||"[]");s.push(t),localStorage.setItem("users",JSON.stringify(s)),console.log("User registered successfully"),localStorage.setItem("currentUser",JSON.stringify(t)),this.$emit("login-success",t),this.$emit("close"),this.registerForm={username:"",email:"",password:""},this.registerError=""}catch(s){console.error("Registration error:",s),this.registerError="注册失败，请重试"}},checkEmailExists(t){const l=JSON.parse(localStorage.getItem("users")||"[]").some(u=>u.email===t);return console.log("Checking email exists:",t,l),l},handleButtonClick(){this.activeTab==="login"?this.handleLogin():this.handleRegister()},toggleTab(){this.activeTab=this.activeTab==="login"?"register":"login"}}},w={class:"modal-dialog"},F={class:"modal-content"},v={class:"modal-header"},y={class:"modal-body"},E={class:"mb-3"},S={class:"mb-3"},k={key:0,class:"alert alert-danger"},T={class:"mb-3"},C={class:"mb-3"},x={class:"mb-3"},U={key:0,class:"alert alert-danger"},N={class:"btn-group w-100"};function R(t,s,l,u,o,i){return n(),a("div",{class:b(["modal fade",{show:l.show}]),tabindex:"-1"},[e("div",w,[e("div",F,[e("div",v,[s[10]||(s[10]=e("h5",{class:"modal-title"},"账户管理",-1)),e("button",{type:"button",class:"btn-close",onClick:s[0]||(s[0]=r=>t.$emit("close"))})]),e("div",y,[o.activeTab==="login"?(n(),a("form",{key:0,onSubmit:s[3]||(s[3]=c((...r)=>i.handleLogin&&i.handleLogin(...r),["prevent"]))},[e("div",E,[s[11]||(s[11]=e("label",{class:"form-label"},"邮箱",-1)),g(e("input",{"onUpdate:modelValue":s[1]||(s[1]=r=>o.loginForm.email=r),type:"email",class:"form-control",required:""},null,512),[[m,o.loginForm.email]])]),e("div",S,[s[12]||(s[12]=e("label",{class:"form-label"},"密码",-1)),g(e("input",{"onUpdate:modelValue":s[2]||(s[2]=r=>o.loginForm.password=r),type:"password",class:"form-control",required:""},null,512),[[m,o.loginForm.password]])]),o.loginError?(n(),a("div",k,d(o.loginError),1)):h("",!0)],32)):(n(),a("form",{key:1,onSubmit:s[7]||(s[7]=c((...r)=>i.handleRegister&&i.handleRegister(...r),["prevent"]))},[e("div",T,[s[13]||(s[13]=e("label",{class:"form-label"},"用户名",-1)),g(e("input",{"onUpdate:modelValue":s[4]||(s[4]=r=>o.registerForm.username=r),class:"form-control",required:""},null,512),[[m,o.registerForm.username]])]),e("div",C,[s[14]||(s[14]=e("label",{class:"form-label"},"邮箱",-1)),g(e("input",{"onUpdate:modelValue":s[5]||(s[5]=r=>o.registerForm.email=r),type:"email",class:"form-control",required:""},null,512),[[m,o.registerForm.email]])]),e("div",x,[s[15]||(s[15]=e("label",{class:"form-label"},"密码",-1)),g(e("input",{"onUpdate:modelValue":s[6]||(s[6]=r=>o.registerForm.password=r),type:"password",class:"form-control",required:""},null,512),[[m,o.registerForm.password]])]),o.registerError?(n(),a("div",U,d(o.registerError),1)):h("",!0)],32)),e("div",N,[e("button",{class:"btn btn-primary",onClick:s[8]||(s[8]=(...r)=>i.handleButtonClick&&i.handleButtonClick(...r))},d(o.activeTab==="login"?"登录":"注册"),1),e("button",{class:"btn btn-secondary",onClick:s[9]||(s[9]=(...r)=>i.toggleTab&&i.toggleTab(...r))}," 切换到"+d(o.activeTab==="login"?"注册":"登录"),1)])])])])],2)}const I=p(f,[["render",R]]);export{I as default};
