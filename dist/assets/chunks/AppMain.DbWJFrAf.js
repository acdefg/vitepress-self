import O from"./Timer.BkHwNIUi.js";import x from"./LoginModal.CIENIlJa.js";import j from"./ReportModal.BGQAErXY.js";import J from"./SettingsModal.BVVZ5fP9.js";import K from"./RoomModal.BCA0e5I3.js";import V from"./WishWallModal.CpV5DYSB.js";import{_ as z,p as i,v as A,B as f,o as h,c as L,j as l,n as G,t as H,e as v,G as B,b as R,g as P}from"./framework.CElktlHO.js";const q={components:{TimerComponent:O,LoginModal:x,ReportModal:j,SettingsModal:J,RoomModal:K,WishWallModal:V},setup(){const c=e=>{try{const n=localStorage.getItem(e);return n?JSON.parse(n):{}}catch(n){return console.error("Error reading from localStorage:",n),{}}},t=i(!1),w=i(!1),o=i(!1),p=i(!1),U=i(!1),r=i(null),M=i({pomodoro:25*60,shortBreak:5*60,longBreak:15*60}),b=i({}),S=i({});A(()=>{r.value=c("currentUser");const e=c("customTimes");e&&(M.value=e);const n=localStorage.getItem("reportStartDate"),s=localStorage.getItem("reportEndDate");n&&s&&(console.log("Loading saved date range:",{start:n,end:s}),_(n,s))});const C=()=>{r.value||(console.log("Opening login modal"),t.value=!0)},D=()=>{w.value=!0},a=()=>{o.value=!0},W=()=>{p.value=!0},I=()=>{U.value=!U.value},E=e=>P(e),T=e=>{console.log("Settings updated:",e),M.value=e},_=(e,n)=>{console.log("Handling report data:",{startDate:e,endDate:n});const s=c("currentUser");console.log("Current user:",s);const d=s?`stats_${s.id}`:"anonymous_stats";let g=c(d)||{};console.log("Retrieved stats:",{key:d,data:g}),(!g||typeof g!="object")&&(g={});const u={};let k=new Date(e);const N=new Date(n);for(;k<=N;){const y=k.toISOString().split("T")[0];u[y]={pomodoro:0,shortBreak:0,longBreak:0,focusMinutes:0,breakMinutes:0,totalMinutes:0},k.setDate(k.getDate()+1)}Object.entries(g).forEach(([y,m])=>{u[y]&&m&&(u[y]={pomodoro:m.pomodoro||0,shortBreak:m.shortBreak||0,longBreak:m.longBreak||0,focusMinutes:m.focusMinutes||0,breakMinutes:m.breakMinutes||0,totalMinutes:(m.focusMinutes||0)+(m.breakMinutes||0)})}),console.log("Processed range data:",u),S.value=u};return{showLoginModal:t,showReportModal:w,showSettingsModal:o,showRoomModal:p,showWishWallModal:U,currentUser:r,toggleUserMenu:C,showReport:D,showSettings:a,showRoom:W,showWishWall:I,getBaseUrl:E,handleSettingsUpdate:T,timerSettings:M,handleReportData:_,getLocalStorage:c,reportData:b,handleLoginModalClose:()=>{console.log("Login modal closing"),t.value=!1},handleLoginSuccess:e=>{console.log("Login success:",e),r.value=e,t.value=!1,c(`stats_${e.id}`)||(console.log("Initializing stats for new user"),localStorage.setItem(`stats_${e.id}`,JSON.stringify({})))},loadUserStats:()=>{var d;const e=((d=r.value)==null?void 0:d.id)||"anonymous",n=e==="anonymous"?"anonymous_stats":`stats_${e}`,s=c(n)||{};return S.value=s,console.log("Loaded user stats:",s),s},handleStatsUpdate:e=>{var d;const n=((d=r.value)==null?void 0:d.id)||"anonymous",s=n==="anonymous"?"anonymous_stats":`stats_${n}`;if(e&&(localStorage.setItem(s,JSON.stringify(e)),S.value=e,w.value)){const g=localStorage.getItem("reportStartDate"),u=localStorage.getItem("reportEndDate");g&&u&&_(g,u)}},logout:()=>{console.log("Logging out"),localStorage.removeItem("currentUser"),r.value=null},currentStats:S,handleDateRangeUpdate:(e,n)=>{if(!(typeof window>"u")){console.log("Updating date range:",{startDate:e,endDate:n});try{localStorage.setItem("reportStartDate",e),localStorage.setItem("reportEndDate",n),_(e,n)}catch(s){console.error("Error updating date range:",s)}}},handleShowLogin:()=>{p.value=!1,t.value=!0}}}},F={class:"app-main"},Q={class:"navbar navbar-expand-lg custom-navbar"},X={class:"menu-pomo"},Y=["href"],Z={class:"d-flex align-items-center mt-3"},$={class:"user-menu-container"},oo={key:0},eo={key:1},to={key:0,class:"logout-dropdown"},no={class:"container"};function so(c,t,w,o,p,U){const r=f("TimerComponent"),M=f("LoginModal"),b=f("ReportModal"),S=f("SettingsModal"),C=f("RoomModal"),D=f("WishWallModal");return h(),L("div",F,[l("div",Q,[l("div",X,[l("div",null,[l("a",{href:o.getBaseUrl("/"),class:"navbar-brand"},"🍅 番茄钟",8,Y)]),l("div",Z,[l("button",{onClick:t[0]||(t[0]=(...a)=>o.showReport&&o.showReport(...a)),class:"btn btn-link nav-link"},"统计"),l("button",{onClick:t[1]||(t[1]=(...a)=>o.showSettings&&o.showSettings(...a)),class:"btn btn-link nav-link"},"设置"),l("div",$,[l("button",{onClick:t[2]||(t[2]=(...a)=>o.toggleUserMenu&&o.toggleUserMenu(...a)),class:G(["btn user-menu",{"logged-in":o.currentUser}])},[o.currentUser?(h(),L("span",oo,H(o.currentUser.username),1)):(h(),L("span",eo,"登录/注册"))],2),o.currentUser?(h(),L("div",to,[l("button",{onClick:t[3]||(t[3]=(...a)=>o.logout&&o.logout(...a)),class:"logout-btn"},"登出")])):v("",!0)])])])]),l("main",no,[B(r,{customTimes:o.timerSettings,currentUser:o.currentUser,onUpdateStats:o.handleStatsUpdate},null,8,["customTimes","currentUser","onUpdateStats"])]),o.showLoginModal?(h(),R(M,{key:0,show:o.showLoginModal,onClose:o.handleLoginModalClose,onLoginSuccess:o.handleLoginSuccess},null,8,["show","onClose","onLoginSuccess"])):v("",!0),B(b,{show:o.showReportModal,"stats-data":o.currentStats,onClose:t[4]||(t[4]=a=>o.showReportModal=!1),onUpdateDateRange:o.handleDateRangeUpdate,onSaveStats:o.handleStatsUpdate},null,8,["show","stats-data","onUpdateDateRange","onSaveStats"]),o.showSettingsModal?(h(),R(S,{key:1,show:o.showSettingsModal,onClose:t[5]||(t[5]=a=>o.showSettingsModal=!1),onSettingsUpdated:o.handleSettingsUpdate},null,8,["show","onSettingsUpdated"])):v("",!0),o.showRoomModal?(h(),R(C,{key:2,show:o.showRoomModal,"current-user":o.currentUser,onClose:t[6]||(t[6]=a=>o.showRoomModal=!1),onShowLogin:o.handleShowLogin},null,8,["show","current-user","onShowLogin"])):v("",!0),o.showWishWallModal?(h(),R(D,{key:3,show:o.showWishWallModal,"current-user":o.currentUser,onClose:t[7]||(t[7]=a=>o.showWishWallModal=!1)},null,8,["show","current-user"])):v("",!0)])}const po=z(q,[["render",so],["__scopeId","data-v-6f24d159"]]);export{po as default};
